<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{% block title %}è³‡ç”£ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ {% endblock %}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", sans-serif;
            margin: 0; 
            padding: 0; 
            background: #f5f5f5; 
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container { 
            max-width: 100%; 
            margin: 0 auto; 
            padding: 16px;
            padding-bottom: 80px;
        }
        
        /* âœ… ä¿®æ­£: ã‚¢ãƒ©ãƒ¼ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤§ããè¡¨ç¤º */
        .alert { 
            padding: 24px 20px; 
            margin: 20px auto;
            max-width: 90%;
            width: 100%;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            animation: slideDown 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-success { 
            background: #d4edda; 
            color: #155724; 
            border: 2px solid #c3e6cb; 
        }
        
        .alert-error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 2px solid #f5c6cb; 
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¯¾å¿œ */
        @media (min-width: 768px) {
            .alert {
                max-width: 600px;
                padding: 28px 24px;
                font-size: 20px;
            }
        }
    </style>
    {% block extra_styles %}{% endblock %}

    <!-- ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå…¨ãƒšãƒ¼ã‚¸å…±é€šã®ä¸Šæ›¸ãè¨­å®šï¼‰ -->
    <style>
        /* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .theme-toggle-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #ddd;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0;
        }

        .theme-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        .theme-icon {
            width: 24px;
            height: 24px;
            stroke: #333;
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: all 0.3s ease;
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        body.dark-mode {
            background: #121212 !important; /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã‚‚ä¸Šæ›¸ã */
            color: #e0e0e0;
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ */
        body.dark-mode .theme-toggle-btn {
            background: rgba(45, 45, 55, 0.9);
            border-color: #555;
        }

        body.dark-mode .theme-icon {
            stroke: #ffd700; /* å¤ªé™½ã®è‰² */
        }

        /* ã‚«ãƒ¼ãƒ‰ãƒ»ã‚³ãƒ³ãƒ†ãƒŠç­‰ã®èƒŒæ™¯è‰²ä¸Šæ›¸ã */
        body.dark-mode .total-card,
        body.dark-mode .asset-card,
        body.dark-mode .summary-card,
        body.dark-mode .stock-card,
        body.dark-mode .chart-container-with-tabs,
        body.dark-mode .header,
        body.dark-mode .edit-form,
        body.dark-mode .login-container,
        body.dark-mode .register-container,
        body.dark-mode .form-modal {
            background: #1e1e1e !important;
            border-color: #333 !important;
            color: #e0e0e0 !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4) !important;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ã®èª¿æ•´ */
        body.dark-mode h1, 
        body.dark-mode h2, 
        body.dark-mode h3, 
        body.dark-mode .header-title,
        body.dark-mode .total-amount,
        body.dark-mode .card-amount-new,
        body.dark-mode .stock-symbol,
        body.dark-mode .summary-value,
        body.dark-mode .stock-price,
        body.dark-mode .profit-amount.zero,
        body.dark-mode .detail-value {
            color: #ffffff !important;
        }

        body.dark-mode .total-label,
        body.dark-mode .card-name-new,
        body.dark-mode .detail-label,
        body.dark-mode .summary-title,
        body.dark-mode .stock-name,
        body.dark-mode .stock-profit-label,
        body.dark-mode .form-group label,
        body.dark-mode .update-time,
        body.dark-mode .register-link,
        body.dark-mode .register-link p {
            color: #aaa !important;
        }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        body.dark-mode input[type="text"],
        body.dark-mode input[type="number"],
        body.dark-mode input[type="password"],
        body.dark-mode select {
            background: #2d2d2d !important;
            border-color: #444 !important;
            color: #fff !important;
        }

        body.dark-mode input:focus,
        body.dark-mode select:focus {
            border-color: #667eea !important;
            background: #333 !important;
        }
        
        /* èª­ã¿å–ã‚Šå°‚ç”¨ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ */
        body.dark-mode input[readonly] {
            background: #252525 !important;
            color: #888 !important;
        }

        /* äºŒæ¬¡çš„ãªèƒŒæ™¯è‰²ï¼ˆè©³ç´°ã‚¨ãƒªã‚¢ãªã©ï¼‰ */
        body.dark-mode .stock-details,
        body.dark-mode .stock-profit-box,
        body.dark-mode .chip,
        body.dark-mode .password-requirements {
            background: #252525 !important;
            border-color: #333 !important;
        }
        
        body.dark-mode .stock-header {
            border-bottom-color: #333 !important;
        }

        /* ãƒœã‚¿ãƒ³ãƒ»ã‚¢ã‚¤ã‚³ãƒ³ */
        body.dark-mode .icon-btn {
            color: #fff !important;
        }
        
        body.dark-mode .back-link {
            color: #66b0ff !important;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        body.dark-mode .form-overlay {
            background: rgba(0,0,0,0.85) !important;
        }
        body.dark-mode .form-close {
            color: #aaa !important;
        }
        
        /* ã‚¿ãƒ– */
        body.dark-mode .tab-nav {
            border-bottom-color: #333 !important;
        }
        body.dark-mode .tab-btn {
            color: #888;
        }
        body.dark-mode .tab-btn.active {
            color: #fff;
            border-bottom-color: #66b0ff !important;
        }
        body.dark-mode .tab-btn:hover:not(.active) {
            color: #bbb;
        }
        
        /* ãƒãƒƒãƒ—ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ï¼‰ */
        body.dark-mode .chip.selected {
            background: rgba(0, 123, 255, 0.2) !important;
            border-color: #0056b3 !important;
        }
        body.dark-mode .chip .chip-label {
            color: #ddd;
        }
        body.dark-mode .chip.selected .chip-label {
            color: #66b0ff;
        }

        /* ã‚¢ãƒ©ãƒ¼ãƒˆ */
        body.dark-mode .alert-success {
            background: rgba(21, 87, 36, 0.3) !important;
            color: #75b798 !important;
            border-color: #1e7e34 !important;
        }
        body.dark-mode .alert-error {
            background: rgba(114, 28, 36, 0.3) !important;
            color: #ea868f !important;
            border-color: #842029 !important;
        }
        
        /* ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸å°‚ç”¨ */
        body.dark-mode .demo-hint {
            background: rgba(102, 126, 234, 0.1) !important;
            border-color: #4a5b9c !important;
            color: #8fa0ff !important;
        }
    </style>
</head>
<body>
    <!-- â˜€ï¸ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒœã‚¿ãƒ³ -->
    <button class="theme-toggle-btn" id="themeToggle" aria-label="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">
        <svg class="theme-icon" viewBox="0 0 24 24" id="themeIcon">
            <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å¤ªé™½ã‚¢ã‚¤ã‚³ãƒ³ -->
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
    </button>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert {% if category == 'error' %}alert-error{% else %}alert-success{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    
    <script>
        (function() {
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
            const savedTheme = localStorage.getItem('theme');
            const themeToggleBtn = document.getElementById('themeToggle');
            const body = document.body;
            
            // åˆæœŸè¨­å®šã®é©ç”¨
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                updateChartDefaults(true);
            } else if (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                // è¨­å®šãŒãªã„å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã®å¥½ã¿ã«åˆã‚ã›ã‚‹
                body.classList.add('dark-mode');
                updateChartDefaults(true);
            } else {
                updateChartDefaults(false);
            }

            // Chart.jsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            function updateChartDefaults(isDark) {
                if (window.Chart) {
                    Chart.defaults.color = isDark ? '#e0e0e0' : '#666';
                    Chart.defaults.borderColor = isDark ? '#444' : '#e0e0e0';
                    // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆã¯ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ãªå ´åˆãŒå¤šã„ãŒã€
                    // æ–°è¦æç”»æ™‚ã¯ã“ã‚Œã§é©ç”¨ã•ã‚Œã‚‹
                }
            }

            // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
            themeToggleBtn.addEventListener('click', () => {
                body.classList.toggle('dark-mode');
                const isDark = body.classList.contains('dark-mode');
                
                // è¨­å®šã‚’ä¿å­˜
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                
                // ãƒãƒ£ãƒ¼ãƒˆã®è¨­å®šã‚’æ›´æ–°ï¼ˆå‹•çš„åæ˜ ã®ãŸã‚ã«ã¯ãƒªãƒ­ãƒ¼ãƒ‰ãŒç¢ºå®Ÿã ãŒã€è¨­å®šå€¤ã¯æ›´æ–°ï¼‰
                updateChartDefaults(isDark);
                
                // ãƒãƒ£ãƒ¼ãƒˆãŒå­˜åœ¨ã™ã‚‹ãƒšãƒ¼ã‚¸ãªã‚‰ãƒªãƒ­ãƒ¼ãƒ‰ã‚’ä¿ƒã™ã‹ã€è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰
                if (document.querySelector('canvas')) {
                    // ãƒãƒ£ãƒ¼ãƒˆã®è‰²ã‚’å³åº§ã«åæ˜ ã•ã›ã‚‹ã®ã¯é›£ã—ã„ãŸã‚ã€
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ãŸã‚ã«ã¯ãƒªãƒ­ãƒ¼ãƒ‰ã—ãªã„æ–¹ãŒè‰¯ã„ãŒã€è‰²ãŒåˆã‚ãªã„å ´åˆãŒã‚ã‚‹ã€‚
                    // ã“ã“ã§ã¯ãƒªãƒ­ãƒ¼ãƒ‰ã›ãšã«CSSå¤‰æ•°ãŒé©ç”¨ã•ã‚Œã‚‹ç¯„å›²ã§å¯¾å¿œ
                }
            });
        })();
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
